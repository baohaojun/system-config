#+title: xdotool is fucking with dvp
# bhj-tags: Bug
å‰äº›å¤©çªç„¶å‘ç°æˆ‘çš„æœ‰äº›æŒ‰é”®å¼€å§‹ä¸çµäº†ï¼ŒæƒŠå‡ºä¸€èº«å†·æ±—ã€‚

äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œä½œä¸ºä¸€ä¸ªé‡åº¦Emacsç”¨æˆ·ï¼Œæˆ‘å–œæ¬¢ç”¨Sawfishï¼ˆä¸€ç§çª—å£ç®¡ç†å™¨ï¼Œå¯ä»¥æŠŠå®ƒæƒ³åƒæˆLinuxä¸‹å…¶ä»–çš„çª—å£ç®¡ç†å™¨ï¼Œæ¯”å¦‚Gnomeã€Kdeï¼‰æŠŠå…¶ä»–çª—å£çš„æŒ‰é”®ä¹Ÿæ˜ å°„æˆEmacsé£æ ¼çš„ã€‚æ¯”å¦‚ç”¨C-f/C-bæ¥è¿›è¡Œå…‰æ ‡å³ç§»/å·¦ç§»çš„æ“ä½œï¼›ç”¨C-s/C-ræ¥å®Œæˆä¸€èˆ¬ç¨‹åºé‡Œç”¨F3/F4å®Œæˆçš„æœç´¢ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªçš„æ“ä½œç­‰ç­‰ã€‚

æœ‰ä¸€ç‚¹è›‹ç–¼äº†å—ï¼Ÿ

æ›´è›‹ç–¼çš„æ˜¯ï¼Œsawfishçš„æŒ‰é”®ä¿®æ”¹å¯¹gtkçš„ç¨‹åºä¸ç®¡ç”¨ï¼Œå› ä¸ºå®ƒç”¨çš„ç»™ç¨‹åºä¼ªé€ é”®ç›˜æ¶ˆæ¯çš„æ¥å£è¢«gtkç¤¾åŒºçš„äººè®¤ä¸ºæœ‰å®‰å…¨é£é™©ï¼Œå°±æŠŠå®ƒç»™ç¦æ­¢äº†ã€‚ä½†æ˜¯ï¼è¿˜æœ‰å¦å¤–ä¸€å¥—XTESTçš„æ¥å£ï¼Œæ˜¯å¯ä»¥ç”¨çš„ï¼xdotoolç”¨çš„å°±æ˜¯è¿™ä¸ªæ¥å£ã€‚

ç”¨sawfishå’Œ/æˆ–xdotoolæ‚¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°Windowsä¸ŠæŒ‰é”®å°ç²¾çµçš„åŠŸèƒ½ã€‚Windowsä¸‹è¿˜æœ‰ä¸€ä¸ªå«autohotkeyçš„ç¨‹åºï¼Œä½†å®ƒçš„è„šæœ¬å†™èµ·æ¥æŒºè´¹åŠ²çš„ï¼ŒåŸºæœ¬ç›¸å½“äºä½ éœ€è¦å¦å­¦ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚

å¥½äº†ï¼Œé—®é¢˜æ¥äº†ï¼Œéšç€Debiançš„å‡çº§ï¼Œä¸çŸ¥ä»€ä¹ˆæ—¶å€™èµ·ï¼Œæˆ‘çªç„¶å‘ç°æœ‰ä¸€å¤©xdotoolä¸èƒ½æ­£å¸¸çš„å·¥ä½œäº†ã€‚æˆ‘æƒ³è®©å®ƒç»™æˆ‘å‘Ctrl-fï¼Œä½†å®ƒç»™æˆ‘å‘Ctrl-uå‡ºæ¥ï¼

ä¸€é˜µæ…Œä¹±ä¹‹åï¼Œæˆ‘å‘ç°äº†è§„å¾‹ï¼Œè¿™ä¸ªBugè·Ÿæˆ‘ç”¨çš„é”®ç›˜å¸ƒå±€æœ‰å…³ï¼Œæˆ‘ç”¨çš„ä¸æ˜¯ä¸€èˆ¬çš„qwertyå¸ƒå±€ï¼Œè€Œæ˜¯dvpå¸ƒå±€ã€‚xdotoolç»™å‘å‡ºæ¥çš„æŒ‰é”®ï¼Œå°±æ˜¯ä»qwertyå¸ƒå±€åˆ°dvpå¸ƒå±€çš„æ˜ å°„/åæ˜ å°„ï¼ˆæˆ‘ä¹Ÿæä¸æ¸…æ¥šæ˜¯æ­£è¿˜æ˜¯åï¼Œåæ­£ä¸å¯¹ğŸ˜­ï¼‰ã€‚

æŠ˜è…¾äº†ä¸€åœˆä¹‹åï¼Œå‘ç°åªè¦æˆ‘åœ¨ç™»å½•åˆ°å›¾å½¢ç•Œé¢ä¹‹åï¼Œé‡æ–°è®¾ç½®è¿‡é”®ç›˜æ˜ å°„ï¼Œxdotoolå°±èƒ½æ­£ç¡®å·¥ä½œäº†ã€‚æˆ‘æ˜¯æ€ä¹ˆå‘ç°çš„å‘¢ï¼Ÿå‘µå‘µï¼Œæˆ‘æœ‰ä¸€ä¸ªè„šæœ¬ï¼Œå« [[https://github.com/baohaojun/system-config/raw/master/bin/toggle-dvp-us.sh][toggle-dvp-us.sh]] ï¼Œå¯ä»¥ç”¨æ¥åˆ‡æ¢dvp/qwertyçš„é”®ç›˜å¸ƒå±€ã€‚ç°åœ¨è¿™ä¸ªé—®é¢˜æ—¢ç„¶è·Ÿé”®ç›˜å¸ƒå±€æœ‰å…³ï¼Œæˆ‘å½“ç„¶ä¼šç”¨è¿™ä¸ªè„šæœ¬åˆ‡æ¢ä¸€ä¸‹å†çœ‹ä¸€çœ¼å’¯ï¼Œå˜¿ï¼Œæ²¡æƒ³åˆ°åˆ‡æ¢ä¹‹åï¼Œé—®é¢˜å°±ä¸è§äº†ï¼Œå†åˆ‡å›dvpä¹Ÿæ²¡æœ‰é—®é¢˜äº†ã€‚

æ‰€ä»¥ï¼Œæœ€åè§£å†³è¿™ä¸ªé—®é¢˜çš„æ€è·¯å¾ˆç®€å•ï¼Œæˆ‘ç”¨ä¸€ä¸ªç¯å¢ƒå˜é‡è®°å½•ä¸€ä¸‹ç™»å½•ä¹‹åæœ‰æ²¡æœ‰é‡æ–°è®¾ç½®è¿‡dvpå¸ƒå±€ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œæˆ‘ç¬¬ä¸€æ¬¡è¿è¡Œxdotoolçš„è„šæœ¬ï¼Œå°±ä¼šé‡æ–°è®¾ç½®ä¸€ä¸‹ï¼Œç„¶åæŠŠé‚£ä¸ªç¯å¢ƒå˜é‡ç»™ç½®ä¸Šï¼Œè¿™æ ·ä¸‹æ¬¡å°±ä¸éœ€è¦é‡æ–°è®¾dvpäº†ï¼š

#+BEGIN_SRC sh
#!/bin/bash
while query-keyboard-state >/dev/null 2>&1; do
    sleep .1;
done

if test "$DONE_AAAAA" != true; then
    setxkbmap -layout us -variant dvp
    re-xmodmap 2>&1 | cat
    sawfish-client -e '(setenv "DONE_AAAAA" "true")'
fi

xdotool "$@"
#+END_SRC

è¿™ä¸ªè„šæœ¬å« [[https://github.com/baohaojun/system-config/raw/master/bin/xdotool-when-keyboard-clear][xdotool-when-keyboard-clear]] ã€‚
