#+title: 专为Smartisan T1而生的小扳手T1Wrench 1.1版使用说明
# bhj-tags: tool

做这个软件最初的原因，是因为我在Linux下没有QQ可以用。后来发现可以把手
机上的QQ通过安卓的input机制控制键盘、触摸屏进行操作的时候，我就想能不
能把整个聊天的功能给它打通。大概就是这样子😊

[[../../../../images/t1wrench-macos.png][file:../../../../images/t1wrench-macos.png]]

* 安装使用步骤

1. 下载

   Windows版本的下载地址在： https://github.com/baohaojun/T1Wrench/archive/T1Wrench-windows.zip

   Mac版本的下载地址在： https://github.com/baohaojun/T1Wrench/archive/T1Wrench-macos.zip

   Linux版本的下载地址在： https://github.com/baohaojun/T1Wrench/archive/T1Wrench-linux.zip

2. 安装

   直接解压即可。

3. 运行

   - Windows :: 点击T1Wrench.exe
   - Mac :: 点击T1Wrench.app
   - Linux :: =./T1Wrench=

   注意Linux上运行小扳手需要自己安装qt5的库和liblua5.2。比如我在Debian上可以这样安装：

   #+BEGIN_SRC sh
   sudo apt-get install qt5-default
   sudo apt-get install liblua5.2-0
   sudo apt-get install lua-md5
   #+END_SRC

   (最后一条是要升级T1Wrench时才需要的，平时运行小扳手并不需要）。

   如果你在用老版本的Ubuntu Linux的话（比如12.04，代号precise），你需
   要上网查一下怎么装这两个包。lua的话自己下载源代码编一个都很简单，
   Windows/Mac下的小扳手的Lua就都是我自己build的。

** 使用

1. 刚启动时，程序界面如图所示：

   [[../../../../images/open-wrench.png][file:../../../../images/open-wrench.png]]

   注意这时如果没有连手机，右下角的图标是红色的。

2. 连接手机

   用USB数据线把手机与PC通过adb连上之后，右下角图标变成绿色，如图所示：

   [[../../../../images/wrench-adb-connected.png][file:../../../../images/wrench-adb-connected.png]]

   关于安卓手机应该怎样与PC通过adb连接的问题，可以上网查一下，这里不再
   赘述。可以参考一下锤子科技论坛的这篇文章：
   http://bbs.smartisan.cn/thread-60797-1-1.html。

   这里简单提一下Windows上配adb要注意的几个点：

   - 装驱动，小扳手Windows版带了驱动，在adb_usb_driver_smartisan目录下，
     省得您还要再上网下载
   - 配adb_usb.ini，里面要有一个0x29a9，这个是锤子科技的usb厂商id。
   - 确保手机上的开发者模式和usb调试已经打开。

   如果以上搞不定的小白、妹子用户，可以就近找一个电脑高手帮你一下😀。

   最后，注意小扳手自己带了一个adb，是谷歌官方的 1.0.31 版，如果你系统
   里安装了最新的1.0.32版的话，强烈建议删掉，这个版本跟小扳手完全不兼
   容😭。你可以在终端（Windows下的cmd.exe）打一下 =adb version= 命令，
   如果不是1.0.31的话都建议把它换掉。

3. 设置小扳手（通过“设置”按钮）

   注意每次小扳手发现手机连上来的时候它都会自动重新设置。所以你不点也
   没有关系。

   这个设置程序主要会做以下几件事件：

   - 获取系统屏幕尺寸。虽然小扳手是为Smartisan T1而生，但是基本上所有
     的安卓手机应该都是支持的，我在小米2上已经做过适配，也可以用。这些
     不同机型、不同屏幕尺寸需要在用小扳手开始聊天之前就确定下来。

   - 目前的Smartisan T1上市版本自带的剪贴板程序比较老，需要更新一下。
     注意需要确保手机系统设置里的这个选项是勾上的才能成功：

     [[../../../../images/adb-setting-unknown-apk.png][file:../../../../images/adb-setting-unknown-apk.png]]

     否则会提示安装失败：

     [[../../../../images/adb-apk-failed.png][file:../../../../images/adb-apk-failed.png]]

     为了系统安全起见，可以在安装完成之后取消这个手机上这个未知来源选项。

3. 文字聊天

   当手机上的QQ等被支持的应用程序处在聊天界面时，比如下图：

   [[../../../../images/Screenshot_2014-11-10-16-21-52_QQ.png][file:../../../../images/Screenshot_2014-11-10-16-21-52_QQ.png]]

   这时可以在小扳手上方的窗口输入，并按Ctrl-Enter（Control+回车键）即
   可发送，也可以点击右下方的锤子按钮（图中用红色圈出部分）：

   [[../../../../images/chat-hello.png][file:../../../../images/chat-hello.png]]

   其余应用程序如微信聊天、微博私信聊天、发送短信等界面使用方法非常类
   似，小扳手会自动识别是哪种窗口，比如发表一条新微博的窗口下，小扳手
   控制手机的方法与微信聊天的方法是不一样的，它会自动识别。如果识别不
   出来是哪种特殊的窗口的话，会一律以微信聊天窗口的控制方法处理。几乎
   所有的聊天程序QQ、微信、微博私信、旺旺等，它们的聊天界面非常类似，
   所以可以用同一种方法处理。

4. 图片和截屏功能

   分别点击相应的按钮即可。

5. 发表文字微博、微信朋友圈

   和3中所说的聊天功能类似，区别只是需要先把微博或者微信的按钮先选中使
   它处于激活状态。如果两个都处于激活状态的话，会同时发表一条微博和一
   条朋友圈分享。

6. 发表图片微博、微信朋友圈

   在微博/微信按钮激活的时候，输入完文字不点发送，而是点图片/截屏按钮
   的话，就会发一条图片微博和、或朋友圈分享。

   如果点图片按钮的话，可以选择多张图片，不要超过9张，因为两个社交应用
   都最多只支持一次发9张图片。

** 常见问题

- 程序后台出错。目前没有好的办法，只能重启小扳手，以后的版本里应该重新
  点一下小扳手的“设置”按钮就好了。如果重启也不能解决问题，并且经常发生
  的话，你可以截一个屏然后微博私信给我看看😂。

- 图片选择错误。在发送图片时可能会发生这种错误，原因不明，估计应该是跟
  手机相册的图片排序方法有关。比如手机上最新的照片是今天拍摄的，这时你
  想发送一张电脑上的老照片，这时候很可能在相册里这张老照片会排到新照片
  的后面。小扳手的工作方式是把要上传的图片发送到手机上，然后就认定这些
  图片因为是手机上最新的图片，所以应该排在最前...

- 偶尔操作失常。小扳手的操作方式基本上是非常机械化的，相当于人用手机聊
  天时各种动作的一个录制回放，所以偶尔某些步骤不一致时操作会失败。比如
  有时手机在后台打开一个大文件，然后QQ聊天的窗口打开速度慢了一点...

- 我用它聊微信从来没有发送成功过。这种情况下您最好换一个输入法试试看，
  会不会是你的输入法有点问题。有些输入法会报一个错误的窗口高度出来，这
  样的话小扳手就不能正确计算出发送按钮的位置。比如我自己最常用的输入法，
  谷歌拼音，它报的窗口大小就是错误的，我只好在代码里硬编码了一个实际测
  量出来的一个高度。


* 功能演示

** 用它聊微信

[[../../../../images/weixin-chat.png][file:../../../../images/weixin-chat.png]]

** 用它聊微博

[[../../../../images/weibo-chat.png][file:../../../../images/weibo-chat.png]]

** 用它聊QQ

[[../../../../images/qq-chat.png][file:../../../../images/qq-chat.png]]

哦，对了，我有说以上三种聊天，它都是支持发图片、截屏的吗？

** 用它聊旺旺

[[../../../../images/wangwang-chat.png][file:../../../../images/wangwang-chat.png]]

** 用它发短信、回短信、回邮件、发Google+，等等等等

无限种可能😄

** 用它在微信朋友圈里评论、回复

** 用它在微信朋友圈里发带段落的文字分享

[[../../../../images/weixin-sns.png][file:../../../../images/weixin-sns.png]]

** 用它发文字微博

[[../../../../images/weibo-share.png][file:../../../../images/weibo-share.png]]

** 用它发文字微信朋友圈分享

[[../../../../images/weixin-share.png][file:../../../../images/weixin-share.png]]

** 用它同时发文字微博和文字微信朋友圈分享

好吧，你是社交达人，影响力无限😄

方法就是同时点中这两个按钮😼

[[../../../../images/both-share.png][file:../../../../images/both-share.png]]

** 用它发图文并茂的微博

** 用它发图文并茂的微信朋友圈分享

** 用它同时发图文并茂的微博和微信朋友圈分享

** 用它为我点赞、涨粉

如果您觉得这个软件好用、有趣，请点一下这个按钮：

[[../../../../images/thumbs-up.png][file:../../../../images/thumbs-up.png]]

* 核心源码公开

所有的核心逻辑都在 [[https://github.com/baohaojun/T1Wrench/raw/windows-release/t1wrench.lua][这个.lua文件]] 里。

比如你可以轻易地在命令行上：

#+BEGIN_SRC sh
t1wrench.lua t1_post 'hello world'
#+END_SRC

如果你跟我一样，是个Linux + Emacs爱好者，建议你用这个脚本自己写一套在
Emacs下聊天的工具，这样即使在Linux下，你也可以聊QQ找女朋友了😄

或者你还可以试试，能不能在Linux下用Emacs聊陌陌，直接约一个？

** 其他手机支不支持？

+安卓4.4以上，分辨率为1920x1080的手机，很有可能可以支持。但有个虚拟按键适配的问题，它会导致屏幕真正的可用空间不足1920x1080。+

+我现在手上只有一个联通版的三星Note3，试了一下，那个点赞的按钮的功能是完好的，其余的功能大部分都不行，因为它是4.3版的安卓，并且不支持升级😠。+

以上划掉的都已经不是问题了。

我做了一定的适配工作，目前试过可以适配的机型有：小米4/小米2S/红米/联想A360t（一款移动定制机，屏幕分辨率相当低）。

有兴趣的同学可以试一下，如果自己的机型不适配的话欢迎给我发patch。

当然，作为锤子科技的员工，更欢迎您购买我们公司的手机😄。

*** 怎样为其他手机做适配？

最重要的就是要获取各种操作发生的位置，建议打开开发者选项里的“显示触摸
操作”和“指针位置”选项，如图：

[[../../../../images/adb-show-touch.png][file:../../../../images/adb-show-touch.png]]

在上面会显示手指按下时的X/Y座标。当然，如果你掌握专门录制座标的工具，
那就更方便了。
