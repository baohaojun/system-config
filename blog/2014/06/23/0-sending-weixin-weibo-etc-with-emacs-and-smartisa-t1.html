<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>åœ¨Linuxä¸‹ç”¨Emacs+Smartisan T1æ‰‹æœºå‘weixin/weibo/qq/email/sms</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Bao Haojun" />
<link rel="stylesheet" href="/css/default.css" type="text/css" />
 <link rel="stylesheet" href="/css/light-blue.css" type="text/css" />
 <link rel="shortcut icon" href="/poison.png" type="image/png" />

    <script type="text/javascript" src="/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript">
        var BYB = {};
    </script>
    <script type="text/javascript">
        BYB.includeScript = function(file,callback){
            var _doc = document.getElementsByTagName('head')[0];
            var js = document.createElement('script');
            js.setAttribute('type', 'text/javascript');
            js.setAttribute('src', file);
            _doc.appendChild(js);

            if (!/*@cc_on!@*/0) { //if not IE
                //Firefox2ã€Firefox3ã€Safari3.1+ã€Opera9.6+ support js.onload
                js.onload = function () {
                    callback();
                }
            } else {
                //IE6ã€IE7 support js.onreadystatechange
                js.onreadystatechange = function () {
                    if (js.readyState == 'loaded' || js.readyState == 'complete') {
                        callback();
                    }
                }
            }
            return false;
        }
    </script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<div id="header">

  <h1 id="blog-title">

    <a href="http://baohaojun.github.io/blog/2011/12/23/index.html">åŒ…æ˜Šå†›çš„åšå®¢</a>

  </h1>
  <p id="description">What you don't know, won't hurt you.</p>

</div>
</div>
<div id='bhj_article'>
  <div id='bhj_leftpane'>
<div id="content">
<h1 class="title">åœ¨Linuxä¸‹ç”¨Emacs+Smartisan T1æ‰‹æœºå‘weixin/weibo/qq/email/sms</h1>
<p>
å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è®²ä¸€è®²æ€ä¹ˆåœ¨Linuxä¸‹ï¼Œç”¨Emacs+Smartisan T1æ¥å‘å¾®ä¿¡ã€
å¾®åšã€QQç­‰æ“ä½œã€‚
</p>

<p>
å…¶å®è¿™åªæ˜¯ä¸€ä¸ªé«˜åº¦è‡ªåŠ¨åŒ–çš„è¿‡ç¨‹ï¼Œæˆ‘æŠŠå‡ ä¸ªå…³é”®ç‚¹å…ˆè¯´ä¸€è¯´ã€‚
</p>

<ol class="org-ol">
<li>ç”¨Emacsç¼–è¾‘è¦å‘é€çš„å†…å®¹
</li>
<li>æŠŠå†…å®¹adb pushåˆ°æ‰‹æœºä¸Šï¼Œæ”¾å…¥æ‰‹æœºçš„å‰ªè´´æ¿
</li>
<li>æ“ä½œæ‰‹æœºçš„è¾“å…¥ï¼Œä¸€èˆ¬æ˜¯é•¿æŒ‰ç¼–è¾‘æ¡†ï¼Œç‚¹ç²˜è´´ï¼Œå†ç‚¹å‘é€æŒ‰é’®
</li>
</ol>

<p>
ä¸ºäº†å®Œæˆä»¥ä¸Šçš„æ­¥éª¤ï¼Œæˆ‘å†™äº†å¾ˆå¤šè„šæœ¬ï¼Œä¸‹é¢æ˜¯æ›´è¯¦ç»†çš„è¯´æ˜ã€‚
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> ç”¨Emacsç¼–è¾‘å†…å®¹</h2>
<div class="outline-text-2" id="text-1">
<p>
è¿™é‡Œæˆ‘ä¼šç”¨åˆ°å‡ ä¸ªè„šæœ¬ï¼Œæ¯”å¦‚ä¸€ä¸ªå«weixinçš„è„šæœ¬ï¼Œè¿˜æœ‰ä¸€ä¸ªå«weiboçš„è„šæœ¬ã€‚
å®ƒä»¬åˆ†åˆ«æ˜¯ç”¨æ¥å‘å¾®ä¿¡å’Œå¾®åšç”¨çš„ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸¤ä¸ªè„šæœ¬æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚å—¯ï¼Œ
åœ¨è¿™é‡Œæˆ‘é‡‡å–äº†busyboxçš„åšæ³•ï¼Œæ ¹æ® <code>argv[0]</code> æ¥å†³å®šç¨‹åºä¸åŒçš„è¡Œä¸ºï¼ˆåœ¨
shellç¼–ç¨‹ä¸­ç›¸åº”çš„æ˜¯ <code>$(basename $0)</code> äº†ï¼‰ã€‚
</p>

<p>
è¿™ä¸ªè„šæœ¬çš„ä½ç½®åœ¨ <a href="https://github.com/baohaojun/system-config/raw/master/bin/adb-send-weixin">adb-send-weixin</a>ï¼š
</p>
<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>

<span class="org-builtin">export</span> <span class="org-variable-name">USE_BUFFER_NAME</span>=send-to-$(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>).org
(
    <span class="org-keyword">if</span> <span class="org-negation-char">!</span> flock -n 9; <span class="org-keyword">then</span>
        find-or-exec emacs <span class="org-string">"No such thing"</span>
        emacsclient -e <span class="org-string">'(switch-to-buffer "'</span>$<span class="org-variable-name">USE_BUFFER_NAME</span><span class="org-string">'")'</span>
        <span class="org-keyword">exit</span>
    <span class="org-keyword">fi</span>

    <span class="org-keyword">while</span> true; <span class="org-keyword">do</span>
        <span class="org-variable-name">input</span>=$(<span class="org-sh-quoted-exec">ask-for-input-with-emacs</span> -p <span class="org-string">"What do you want say on $(</span><span class="org-sh-quoted-exec">basename</span><span class="org-string"> $0)?"</span> || true)
        <span class="org-keyword">if ! </span><span class="org-builtin">test</span> <span class="org-string">"$input"</span>; <span class="org-keyword">then</span>
            <span class="org-keyword">exit</span>
        <span class="org-keyword">fi</span>
        (
            flock 10
            putclip-android <span class="org-string">"$input"</span>&amp;
            <span class="org-keyword">if </span><span class="org-builtin">test</span> $(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>) = google+; <span class="org-keyword">then</span>
                adb-long-press 144 374 <span class="org-comment-delimiter"># </span><span class="org-comment">long press</span>
                adb-tap 117 273 <span class="org-comment-delimiter"># </span><span class="org-comment">paste</span>
                adb-tap 949 935 <span class="org-comment-delimiter"># </span><span class="org-comment">send</span>
            <span class="org-keyword">elif </span><span class="org-builtin">test</span> $(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>) = weibo; <span class="org-keyword">then</span>
                adb input keyevent SPACE
                adb-long-press 440 281; adb-tap 545 191
                adb-tap 991 166
            <span class="org-keyword">elif </span><span class="org-builtin">test</span> $(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>) = t1-sms; <span class="org-keyword">then</span>
                adb-tap 560 1840 <span class="org-comment-delimiter"># </span><span class="org-comment">&#28857;&#31354;&#26684;</span>
                adb-long-press 522 912 <span class="org-comment-delimiter"># </span><span class="org-comment">&#38271;&#25353;&#36755;&#20837;&#26694;</span>
                adb-tap 480 802
                adb-tap 864 921
            <span class="org-keyword">elif </span><span class="org-builtin">test</span> $(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>) = cell-mail; <span class="org-keyword">then</span>
                adb shell input touchscreen swipe 586 878 586 268 500
                adb-tap 560 1840 <span class="org-comment-delimiter">#</span>
                adb-long-press 322 283
                adb-tap 505 192
                adb-tap 998 174
            <span class="org-keyword">else</span> <span class="org-comment-delimiter"># </span><span class="org-comment">weixin and qq</span>
                adb-tap 560 1840 <span class="org-comment-delimiter"># </span><span class="org-comment">&#28857;&#19968;&#19979;&#24213;&#37096;&#36755;&#20837;&#26694;&#65292;&#24377;&#20986;&#36719;&#38190;&#30424;</span>
                sleep .1
                adb-tap 560 1840 <span class="org-comment-delimiter"># </span><span class="org-comment">&#20877;&#28857;&#19968;&#19979;&#65292;&#21487;&#33021;&#22312;&#20986;&#38190;&#30424;&#65292;&#38656;&#35201;&#36755;&#20837;&#19968;&#20010;&#31354;&#26684;</span>
                adb-long-press 560 976 <span class="org-comment-delimiter"># </span><span class="org-comment">&#38271;&#28857;&#36755;&#20837;&#26694;</span>
                adb-tap 525 855 <span class="org-comment-delimiter"># </span><span class="org-comment">&#28857;&#19968;&#19979;&#31896;&#36148;&#38062;</span>
                adb-tap 976 976 <span class="org-comment-delimiter"># </span><span class="org-comment">&#28857;&#19968;&#19979;&#21457;&#36865;&#38062;</span>
            <span class="org-keyword">fi</span>
        ) 10&gt; ~/.logs/$(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>).lock-send &amp;
    <span class="org-keyword">done</span>
) 9&gt; ~/.logs/$(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>).lock
</pre>
</div>

<p>
ç„¶åæœ‰Nä¸ªè„šæœ¬éƒ½æ˜¯æŒ‡å‘è¿™ä¸ª adb-send-weixin çš„è½¯é“¾æ¥ï¼š
</p>

<pre class="example">
$ls -l |grep weixin
-rwxr-xr-x 1 bhj bhj    1807 Jun 23 16:53 adb-send-weixin*
lrwxrwxrwx 1 bhj bhj      15 Jun 20 11:55 cell-mail -&gt; adb-send-weixin*
lrwxrwxrwx 1 bhj bhj       6 Jun 17 11:16 google+ -&gt; weixin*
lrwxrwxrwx 1 bhj bhj      15 Jun 10 11:27 qq -&gt; adb-send-weixin*
lrwxrwxrwx 1 bhj bhj       6 Jun 23 16:47 t1-sms -&gt; weixin*
lrwxrwxrwx 1 bhj bhj      15 Jun 20 1ğŸ˜‡6 weibo -&gt; adb-send-weixin*
lrwxrwxrwx 1 bhj bhj      15 Jun  7 12:04 weixin -&gt; adb-send-weixin*
</pre>

<p>
è¿™ä¸ªè„šæœ¬å¤§è‡´çš„å·¥ä½œæ˜¯å¯åŠ¨ä¸€ä¸ªæ­»å¾ªç¯ï¼Œç¬¬äºŒæ®µé‡Œçš„ <code>while true; do
... done</code> ï¼Œå…ˆç”¨ask-for-input-with-emacsè·å–æˆ‘è¦åœ¨weixin/weiboé‡Œè¾“å…¥çš„
å†…å®¹ï¼Œç„¶åç”¨putclip-androidæŠŠè¿™ä¸ªå†…å®¹æ”¾åˆ°æ‰‹æœºçš„å‰ªè´´æ¿é‡Œå»ï¼Œç„¶åç”¨ä¸€å †
adb-long-press/adb-tapç­‰æ“ä½œæŠŠè´´åˆ°æ‰‹æœºåº”ç”¨ç¨‹åºé‡Œå¹¶å‘é€å‡ºå»ã€‚
</p>

<p>
ä¸Šé¢ç”¨çš„åæ ‡å…¨æ˜¯ç”¨æˆ‘å‚çš„Smartisan T1æ‰‹æœºé€‚é…å‡ºæ¥çš„ï¼Œå¦‚æœç”¨åˆ«çš„å‚çš„æ‰‹æœº
çš„è¯ï¼Œå¤§å®¶éœ€è¦è‡ªå·±é€‚é…ä¸€ä¸‹å•¦ã€‚
</p>

<p>
é€‚é…çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ‰“å¼€æ‰‹æœºè®¾ç½®é‡Œçš„å¼€å‘è€…é€‰é¡¹ï¼Œå‹¾é€‰ä¸Šæ˜¾ç¤ºè§¦æ‘¸æ“ä½œ
å’ŒæŒ‡é’ˆä½ç½®ï¼Œè¿™æ ·ä½ åœ¨å±å¹•ä¸ŠæŒ‡æŒ‡ç‚¹ç‚¹çš„æ—¶å€™ï¼ŒX/Yçš„åº§æ ‡ä¼šè¢«æ˜¾ç¤ºä¸Šå±å¹•ä¸Šæ–¹ã€‚
å¦ä¸€ç§åˆ™æ˜¯æˆ‘å†™çš„å¦ä¸€ä¸ªå°è„šæœ¬ï¼Œåœ¨å±å¹•ä¸Šé•¿æŒ‰æ‰‹æŒ‡åœ¨ä¸€ä¸ªä½ç½®ï¼Œä¼šæ‰“åº”å‡ºç›¸åº”
çš„åæ ‡ã€‚äºŒè€…å„æœ‰åˆ©å¼Šï¼Œä¸»è¦æ˜¯ç¬¬ä¸€ç§è€æ˜¯è¦æ‰“å¼€ä¹‹ååˆè¦è®°å¾—å…³é—­ï¼Œæ“ä½œæ¯”è¾ƒ
ç¹çï¼Œç¬¬äºŒç§å‘¢ï¼Œåˆ™ä¸æ˜¯å®æ—¶çš„æ˜¾ç¤ºåæ ‡ã€‚å“¦å¯¹äº†ï¼Œæˆ‘è‡ªå·±ç°åœ¨æ˜¯ç”¨ç¬¬äºŒç§æ¯”è¾ƒ
å¤šäº†ï¼Œå› ä¸ºæˆ‘å¯ä»¥æˆªä¸€å¼ å›¾ä¸‹æ¥æ…¢æ…¢ç‚¹ã€‚Smartisan T1æˆªå›¾çœŸçš„æ˜¯è¶…æ–¹ä¾¿ã€‚å°è„š
æœ¬çš„ä½ç½®åœ¨<a href="https://github.com/baohaojun/system-config/raw/master/bin/adb-get-xy">adb-get-xy</a>ã€‚
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>

adb getevent -l |perl -ne <span class="org-string">'</span>
<span class="org-string">    if (m/ABS_MT_POSITION_/) {</span>
<span class="org-string">        chomp;</span>
<span class="org-string">        @fields = split;</span>
<span class="org-string">        ($name, $val) = @fields[2,3];</span>
<span class="org-string">        $val = hex($val);</span>
<span class="org-string">        print "$name: $val\n";</span>
<span class="org-string">    }</span>
<span class="org-string">'</span>
</pre>
</div>

<p>
å…¶è¾“å‡ºç»“æœå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š
</p>

<pre class="example">
$adb-get-xy
ABS_MT_POSITION_X: 550
ABS_MT_POSITION_Y: 1006
ABS_MT_POSITION_X: 549
ABS_MT_POSITION_X: 548
ABS_MT_POSITION_X: 547
ABS_MT_POSITION_X: 546
ABS_MT_POSITION_X: 545
ABS_MT_POSITION_X: 544
ABS_MT_POSITION_X: 543
</pre>

<p>
ä¸‹é¢æ¥è®²ä¸€ä¸‹adb-send-to-weixiné‡Œç”¨åˆ°çš„ä¸€äº›å…¶ä»–è¾…åŠ©è„šæœ¬å’Œå‘½ä»¤ã€‚
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> flock</h3>
<div class="outline-text-3" id="text-1-1">
<p>
flockæ˜¯å¸¸ç”¨çš„ä¸€ä¸ªshellä¸‹é€šè¿‡æ–‡ä»¶é”æ¥è¿›è¡Œè¿›ç¨‹é—´åŒæ­¥äº’æ–¥çš„æœºåˆ¶ï¼Œåœ¨è¿™é‡Œæˆ‘
ç”¨äº†ä¸¤ä¸ªflockï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯è¯´å¦‚æœå‘ç°weixinæ­»å¾ªç¯å·²ç»åœ¨è·‘çš„è¯ï¼Œæ–°çš„æ­»å¾ª
ç¯å°±ä¸å¼€å¯äº†ï¼Œè€Œæ˜¯é€šè¿‡find-or-execæŠŠEmacsçª—å£æåˆ°å‰é¢æ¥ï¼Œå†é€šè¿‡
emacsclientæŠŠæ­£åœ¨è¿›è¡Œweixinç¼–è¾‘çš„Emacs bufferè°ƒåˆ°å‰é¢æ¥ã€‚
</p>

<p>
å¦ä¸€ä¸ªflockåˆ™æ˜¯ä¸ºäº†è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œæ¯æ¬¡æˆ‘ç¼–è¾‘å®Œä¸€æ¡weixinå†…å®¹ä¹‹åï¼Œæˆ‘å°±
åœ¨åå°(bashçš„&amp;ç¬¦å·)æ‰§è¡Œæ‰‹æœºä¸Šçš„æ“ä½œï¼ˆæ”¾å‰ªè´´æ¿ã€å„ç§é•¿æŒ‰çŸ­æŒ‰ï¼‰ï¼Œè¿™äº›å
å°æ“ä½œæˆ‘æ˜¯è‚¯å®šä¸å¸Œæœ›å®ƒä»¬æœ‰é‡åˆçš„ï¼Œå¦åˆ™å°±ä¼šä¹±å¥—ã€‚è¿™æ ·å‘¢ï¼Œæˆ‘å¯ä»¥é©¬ä¸Šè¿›è¡Œ
ä¸‹ä¸€æ¡å¾®ä¿¡çš„ç¼–è¾‘ï¼Œç„¶åæ˜¯å†ä¸‹ä¸€æ¡ï¼Œä¸éœ€è¦ç­‰æ‰‹æœºæŠŠä¸Šä¸€æ¡å¾®ä¿¡å‘å‡ºå»å…ˆï¼Œå¦‚
æœweixinèŠå¤©ä¹Ÿèƒ½æœ‰flowçš„çŠ¶æ€çš„è¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æˆ‘çš„flowçŠ¶æ€ä¸ä¼šè¢«æ‰“æ–­äº†ğŸ˜Š
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> find-or-exec</h3>
<div class="outline-text-3" id="text-1-2">
<p>
è¿™æ˜¯ä¸€æ®µsawfishè„šæœ¬ï¼Œå¯¹æˆ‘çš„Linuxæ¡Œé¢ç®¡ç†å™¨æ˜¯sawfishã€‚è§ <a href="https://github.com/baohaojun/system-config/raw/master/bin/find-or-exec">find-or-exec</a> ã€‚
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>

<span class="org-builtin">set</span> -e

<span class="org-keyword">function</span> <span class="org-function-name">die</span>() {
    <span class="org-builtin">echo</span> Error: <span class="org-string">"$@"</span>
    <span class="org-keyword">exit</span> -1
}

<span class="org-keyword">if </span><span class="org-builtin">test</span> $<span class="org-variable-name">#</span> = 0; <span class="org-keyword">then</span>
    die <span class="org-string">"Error: Usage $(</span><span class="org-sh-quoted-exec">basename</span><span class="org-string"> $0) window_class [program_to_exec]"</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if </span><span class="org-builtin">test</span> <span class="org-string">"$1"</span> = konsole; <span class="org-keyword">then</span>
    <span class="org-builtin">shift</span>;
    <span class="org-builtin">set</span> -- <span class="org-string">"konsole|xfce4-terminal"</span> <span class="org-string">"$@"</span>
<span class="org-keyword">fi</span>

<span class="org-variable-name">sawfish_exp</span>=$(<span class="org-sh-quoted-exec">printf</span> <span class="org-string">'(find-window-or-exec "%s" "%s")'</span> <span class="org-string">"$1"</span> <span class="org-string">"${2:-true}"</span>)

sawfish-client -e <span class="org-string">"$sawfish_exp"</span> &gt;/dev/null 2&gt;&amp;1 &amp;
</pre>
</div>

<p>
è¿™æ˜¯ä¸€æ®µbashè„šæœ¬ï¼Œå¦‚æœä½ ç”¨bash -xçœ‹å®ƒçš„traceçš„è¯ï¼Œä½ ä¼šå‘ç°ï¼š
</p>

<pre class="example">
$bash -x find-or-exec emacs
+ set -e
+ test 1 = 0
+ test emacs = konsole
++ printf '(find-window-or-exec "%s" "%s")' emacs true
+ sawfish_exp='(find-window-or-exec "emacs" "true")'
+ sawfish-client -e '(find-window-or-exec "emacs" "true")'
</pre>

<p>
æœ€åä¼šè°ƒä¸€ä¸ªfind-window-or-execçš„sawfishå‡½æ•°ï¼Œæˆ‘æ˜¯è¿™æ ·å®šä¹‰çš„ ï¼ˆè§æˆ‘çš„
<a href="https://github.com/baohaojun/system-config/raw/master/.sawfishrc">.sawfishrc</a>ï¼‰ï¼š
</p>

<div class="org-src-container">

<pre class="src src-sawfish"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">find-window-or-exec</span> <span class="org-rainbow-delimiters-depth-2">(</span>wclass-or-lambda #!optional wcommand<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>eq <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">catch</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">wFound</span>
            <span class="org-rainbow-delimiters-depth-5">(</span>mapc <span class="org-rainbow-delimiters-depth-6">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-7">(</span>window<span class="org-rainbow-delimiters-depth-7">)</span>
                    <span class="org-rainbow-delimiters-depth-7">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-8">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-9">(</span>stringp wclass-or-lambda<span class="org-rainbow-delimiters-depth-9">)</span>
                              <span class="org-rainbow-delimiters-depth-9">(</span>string-match wclass-or-lambda <span class="org-rainbow-delimiters-depth-1">(</span>bhj-window-class window<span class="org-rainbow-delimiters-depth-1">)</span> 0 t<span class="org-rainbow-delimiters-depth-9">)</span>
                            <span class="org-rainbow-delimiters-depth-9">(</span><span class="org-keyword">when</span> functionp wclass-or-lambda
                                  <span class="org-rainbow-delimiters-depth-1">(</span>write <span class="org-rainbow-delimiters-depth-2">(</span>stderr-file<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-string">"hello world\n"</span><span class="org-rainbow-delimiters-depth-1">)</span>
                                  <span class="org-rainbow-delimiters-depth-1">(</span>wclass-or-lambda window<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-rainbow-delimiters-depth-9">)</span><span class="org-rainbow-delimiters-depth-8">)</span>

                      <span class="org-rainbow-delimiters-depth-8">(</span>bhj-activate-window window<span class="org-rainbow-delimiters-depth-8">)</span>
                      <span class="org-rainbow-delimiters-depth-8">(</span><span class="org-keyword">throw</span> <span class="org-highlight-quoted-quote">'</span><span class="org-constant">wFound</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">wFound</span><span class="org-rainbow-delimiters-depth-8">)</span><span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span>
                  <span class="org-rainbow-delimiters-depth-6">(</span>stacking-order<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
          <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">wFound</span><span class="org-rainbow-delimiters-depth-3">)</span>
      t
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> wcommand
        <span class="org-rainbow-delimiters-depth-4">(</span>system <span class="org-rainbow-delimiters-depth-5">(</span>concat wcommand <span class="org-string">"&amp;"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
è¿™ä¸ªå°±ä¸å±•å¼€äº†ï¼Œå†å±•å¼€å°±è¦æ ˆæº¢å‡ºäº†ğŸ˜Š
</p>

<p>
ä½†æ˜¯find-or-execçš„ç¡®æ˜¯ä¸€ä¸ªæˆ‘å¾ˆå¸¸ç”¨çš„æ–¹ä¾¿æˆ‘åœ¨Emacs/Terminalä¹‹é—´åˆ‡æ¢çš„ç¨‹
åºã€‚è®¾æƒ³æˆ‘åœ¨Terminalåº•ä¸‹æ‰§è¡Œä¸€æ®µbashè„šæœ¬ï¼Œé‡Œé¢ç”¨åˆ°äº†emacsï¼Œå®ƒèƒ½ç›´æ¥å¸®
æˆ‘æŠŠEmacsçª—å£å¼¹åˆ°å‰é¢æ¥ï¼›ç­‰Emacsæ“ä½œç»“æŸåï¼Œå®ƒåˆèƒ½æŠŠTerminalç»™æˆ‘å¼¹å›æ¥ã€‚
</p>

<p>
å¸¸æœ‰ä¸€äº›Emacsçš„å¤§ä»™è¯´ç”¨Emacså¯ä»¥åœ¨Emacså†…å¼€eshellä»€ä¹ˆçš„ï¼Œæ°¸è¿œä¸éœ€è¦ç¦»
å¼€Emacsçª—å£ã€‚ä½†é¦–å…ˆeshellç­‰éƒ½æ¯”è¾ƒæœ‰é—®é¢˜ï¼Œè¿˜æœ‰æ€§èƒ½ä»€ä¹ˆçš„ã€‚å¹¶ä¸”ä½ è¿˜æ˜¯å¾—
åˆ‡æ¢bufferå˜›ã€‚ç„¶åæˆ‘çš„find-or-execå¯ä»¥åšåˆ°è‡ªåŠ¨å¸®æˆ‘åˆ‡æ¢ï¼Œæ‰€ä»¥è¿™å›æˆ‘å°±æ²¡
å¬å¤§ä»™ä»¬çš„ã€‚
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> putclip-android</h3>
<div class="outline-text-3" id="text-1-3">
<p>
putclip/getclipæ˜¯cygwinä¸‹çš„ç¨‹åºã€‚åœ¨Linuxåº•ä¸‹æœ‰ä¸€ä¸ªxclipï¼Œåœ¨Mac OS Xåº•
ä¸‹æœ‰ä¸€ä¸ªpbcopy/pbpasteã€‚
</p>

<p>
ä½†ä¸ºäº†æˆ‘è‡ªå·±ç¼–ç¨‹å†™è„šæœ¬ã€ç»ˆç«¯ä¸Šæ‰“å‘½ä»¤èƒ½å¤Ÿç»Ÿä¸€ï¼Œæˆ‘ä½¿ç”¨äº†design patterné‡Œ
çš„ä¸çŸ¥å“ªç§æ¨¡å¼ï¼Œåœ¨Linuxä¸‹å’ŒMac OS Xä¸‹ä¹Ÿå®ç°äº†ä¸€ä¸ªç›¸åº”åœ°ç”¨xclipå’Œ
pbcopy/pbpasteå®ç°äº†putclip/getclipã€‚
</p>

<p>
åœ¨Linuxä¸‹çš„putclipåŠŸèƒ½æœ€å¤æ‚ï¼Œä¹Ÿæœ€å¼ºå¤§ã€‚è§ <a href="https://github.com/baohaojun/system-config/raw/master/bin/Linux/putclip">putclip</a> ã€‚
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>
<span class="org-keyword">if </span><span class="org-builtin">echo</span> $<span class="org-variable-name">SHELLOPTS</span> | grep xtrace; <span class="org-keyword">then</span>
    <span class="org-builtin">export</span> SHELLOPTS
<span class="org-keyword">fi</span>
<span class="org-keyword">if </span><span class="org-builtin">test</span> $<span class="org-variable-name">#</span> != 0; <span class="org-keyword">then</span>
    <span class="org-keyword">exec</span> &lt;&lt;EOF
<span class="org-sh-heredoc">$@</span>
<span class="org-sh-heredoc">EOF</span>
<span class="org-keyword">fi</span>

<span class="org-keyword">if </span><span class="org-builtin">test</span> <span class="org-string">"$EMACS"</span> = t -o <span class="org-string">"$REMOTEIP"</span>; <span class="org-keyword">then</span>
    rm-last-nl &gt; /tmp/$<span class="org-variable-name">$</span>.putclip
    <span class="org-builtin">export</span> <span class="org-variable-name">FILE</span>=/tmp/$<span class="org-variable-name">$</span>.putclip
    (
        <span class="org-keyword">if </span><span class="org-builtin">test</span> <span class="org-string">"$REMOTEIP"</span> = <span class="org-string">""</span>; <span class="org-keyword">then</span>
            <span class="org-variable-name">prefix</span>=<span class="org-string">""</span>
            <span class="org-variable-name">arg_handler</span>=echo
        <span class="org-keyword">else</span>
            <span class="org-keyword">if </span><span class="org-builtin">test</span> -e ~/.config/ssh-agent; <span class="org-keyword">then</span>
                <span class="org-builtin">.</span> ~/.config/ssh-agent
            <span class="org-keyword">fi</span>
            ssh ${<span class="org-variable-name">REMOTEUSER</span>:-$<span class="org-variable-name">USER</span>}@$<span class="org-variable-name">REMOTEIP</span> remote-putclip $(<span class="org-sh-quoted-exec">whoami</span>)@$<span class="org-variable-name">LOCALIP</span>:$<span class="org-variable-name">FILE</span>
            <span class="org-keyword">exit</span> 0
        <span class="org-keyword">fi</span>

        $<span class="org-variable-name">prefix</span> emacsclient --eval <span class="org-string">"</span>
<span class="org-string">(let ((default-directory \"/tmp/\"))</span>
<span class="org-string">(view-file \"$FILE\")</span>
<span class="org-string">(kill-new (filter-buffer-substring (point-min) (point-max)))</span>
<span class="org-string">(View-quit))"</span>
        $<span class="org-variable-name">prefix</span> rm $<span class="org-variable-name">FILE</span>
        xclip -o -selection clipboard|xclip -i
    ) &gt;~/.logs/putclip.log 2&gt;&amp;1&amp;
<span class="org-keyword">else</span>
    rm-last-nl|xclip -i -selection clipboard &gt;/dev/null 2&gt;&amp;1
    xclip -o -selection clipboard|xclip -i &gt;/dev/null 2&gt;&amp;1
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
ç®€å•åœ°è¯´ï¼Œå®ƒåœ¨sshè¿œç¨‹ç™»å½•å’ŒEmacsåº•ä¸‹éƒ½èƒ½ç”¨ã€‚ä¸ºä»€ä¹ˆè¿™ä¸ªäº‹æƒ…å€¼å¾—è¯´ä¸€ä¸‹å‘¢ï¼Ÿ
å› ä¸ºé¦–å…ˆsshç™»å½•ä¹‹åå¦‚æœè¿˜èƒ½ç»§ç»­ç”¨putclipçš„è¯ï¼ˆæ²¡æœ‰ç”¨ssh -Xï¼Œæ‰€ä»¥ä¸èƒ½
xclipï¼‰ï¼Œå‘½ä»¤è¡Œå’ŒGUIèƒ½ç»“åˆå¾—æ›´å¥½ã€‚ç„¶ååœ¨Emacsä¸‹ï¼Œç›´æ¥æ“ä½œxclipæ˜¯ä¼šå¼•èµ·
æ­»é”çš„ï¼Œå› ä¸ºEmacsæ˜¯ä¸ªå•çº¿ç¨‹ç¨‹åºï¼Œå®ƒæ‰§è¡Œxclipå‘½ä»¤ä¹‹åï¼Œå°±ä¼šç­‰å¾…ç»“æŸï¼Œå¯
æ˜¯å‘¢xclipåˆè¦ç­‰æŒæœ‰ç€Xå‰ªè´´æ¿å†…å®¹çš„ç¨‹åºè·Ÿå®ƒé€šè®¯ï¼ŒæŠŠå‰ªè´´æ¿å†…å®¹ä¼ è¿‡æ¥ã€‚è®¾
æƒ³ä¸€ä¸‹æŒæœ‰Xå‰ªè´´æ¿å†…å®¹çš„ç¨‹åºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šæ˜¯è°å‘¢ï¼Ÿå°±æ˜¯Emacsè‡ªå·±ï¼
</p>

<p>
è¿™äº›æ˜¯é¢˜å¤–è¯ï¼Œæ‚¨çœ‹æˆ‘çš„åšå®¢ä¹°ä¸€é€ä¸€ï¼Œè·Ÿputclip-androidæ²¡ä»€ä¹ˆå…³ç³»ã€‚è¿™ä¸ªè„šæœ¬è§ <a href="https://github.com/baohaojun/system-config/raw/master/bin/putclip-android">putclip-android</a> ã€‚
</p>


<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>

<span class="org-keyword">if </span><span class="org-builtin">test</span> <span class="org-string">"$#"</span> = 0; <span class="org-keyword">then</span>
    <span class="org-builtin">set</span> -- <span class="org-string">"$(</span><span class="org-sh-quoted-exec">ask-for-input-with-emacs</span><span class="org-string">)"</span>
<span class="org-keyword">fi</span>
<span class="org-builtin">echo</span> -n <span class="org-string">"$@"</span> &gt; ~/.logs/$(<span class="org-sh-quoted-exec">basename</span> $<span class="org-variable-name">0</span>).txt

adb <span class="org-string">"set -x;</span>
<span class="org-string">echo -n $(</span><span class="org-sh-quoted-exec">printf</span><span class="org-string"> %q "$@") &gt; /sdcard/putclip.txt</span>
<span class="org-string">am startservice -n com.bhj.setclip/.PutClipService</span>
<span class="org-string">for x in \$(</span><span class="org-sh-quoted-exec">seq</span><span class="org-string"> 1 20); do if test -e /sdcard/putclip.txt; then busybox sleep .1; echo \$x; else exit; fi; done"</span>
</pre>
</div>
</div>

<div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1"><span class="section-number-4">1.3.1</span> adb</h4>
<div class="outline-text-4" id="text-1-3-1">
<p>
ç¬¬ä¸‰å±‚æ ‡é¢˜äº†ã€‚æˆ‘ä¿è¯ä¸ä¼šå‡ºç°ç¬¬å››å±‚æ ‡é¢˜ã€‚
</p>

<p>
ä¸Šé¢è¿™ä¸ªè„šæœ¬é‡Œæˆ‘çš„adbå‘½ä»¤ç”¨æ³•å¾ˆå¥‡ç‰¹ï¼Œå®ƒç›´æ¥è·Ÿäº†ä¸€å¤§æ®µshellè„šæœ¬ï¼Œæ²¡æœ‰ç”¨
adb shell COMMANDè¿™ä¸ªå½¢å¼ã€‚è¿™æ˜¯å› ä¸ºæˆ‘å«Œæ¯æ¬¡éƒ½è¦æ‰“shellè¿™ä¸ªå•è¯å¤ªç´¯äº†ã€‚
</p>

<p>
å¦‚æœä½ ä»¥ä¸ºæˆ‘åªæ˜¯æŠŠshellå»æ‰è€Œå·²çš„è¯ä½ å°±é”™äº†ï¼
</p>

<p>
æˆ‘æ›´å¤šçš„å·¥ä½œæ˜¯åœ¨å¼•å·çš„å¤„ç†å’Œç»ˆç«¯çš„äº¤äº’ä¸Šã€‚
</p>

<p>
å…ˆè¯´è¯´ç»ˆç«¯çš„äº¤äº’ã€‚åƒsuå‘½ä»¤é‚£æ ·ï¼Œsu -c "echo hello world" æœ‰ç‚¹åƒadb
shell "echo hello world"ï¼Œä½† su -c "bash"å°±è·Ÿadb shell bashå¾ˆä¸ä¸€æ ·äº†ï¼Œ
å‰è€…ä½ èƒ½å¾—åˆ°ä¸€ä¸ªå¯ä»¥äº¤äº’çš„shellï¼Œåè€…ä½ è¾“å…¥ä»»ä½•å‘½ä»¤éƒ½æ²¡æœ‰å“åº”ã€‚è¿™ä¸ªé—®
é¢˜æˆ‘æ˜¯é€šè¿‡expectè§£å†³çš„ã€‚
</p>

<p>
æˆ‘çš„adbåŒ…è£…è¿‡ä¹‹åæ‰§è¡Œadb shell bashæ—¶ï¼Œå®ƒä¼šæ‰§è¡Œexpectï¼Œç„¶åspawnå‡ºä¸€ä¸ª
adb shellï¼Œç„¶åæŠŠæ‰€æœ‰çš„å‚æ•°ï¼ˆåœ¨è¿™é‡Œæ˜¯bashï¼‰å‘è¿‡å»ï¼Œæ‰€ä»¥æœ€åçš„ç»“æœå°±åƒ
æ˜¯ä½ è‡ªå·±å¯åŠ¨äº†ä¸€ä¸ªadb shellï¼Œç„¶åå†åœ¨å¯ä»¥äº¤äº’çš„æç¤ºç¬¦ä¸‹è¾“å…¥äº†bashã€‚è§
<a href="https://github.com/baohaojun/system-config/raw/master/bin/adb-expect">adb-expect</a>ã€‚
</p>

<p>
å¼•å·çš„å¤„ç†åˆ™ç›¸å½“çš„å¥‡è‘©ã€‚adbçš„.cç¨‹åºåœ¨å¤„ç†å‚æ•°çš„æ—¶å€™å¦‚æœå‘ç°æŸä¸ªå‚æ•°é‡Œ
å¸¦æœ‰ç©ºæ ¼ï¼Œå°±ä¼šåœ¨å®ƒçš„ä¸¤å¤´å„åŠ ä¸Šä¸€ä¸ªåŒå¼•å·ã€‚æ‰€ä»¥ï¼š
</p>

<pre class="example">
{ bhj@bhj-laptop /home/bhj/system-config/bin Ret: 130 @ 21:51:38 }
$the-true-adb shell echo "hello    world"
hello    world

{ bhj@bhj-laptop /home/bhj/system-config/bin }
$echo "hello    world"
hello    world
</pre>

<p>
è¿™ä¸ªè·Ÿç›´æ¥åœ¨bashé‡Œæ‰“ <code>(echo "hello world")</code> æ•ˆæœæ˜¯ä¸€è‡´çš„ï¼ˆä¸ºäº†è®©è¿™ä¸ªå‘½
ä»¤åœ¨org-modeé‡Œå˜æˆmonospaceå­—ä½“ï¼Œæˆ‘å¿…é¡»åŠ ä¸€ä¸ªæ‹¬å·ï¼Œæœ‰è°çŸ¥é“æ›´å¥½çš„åŠæ³•
ä¹ˆï¼Ÿï¼‰ã€‚å¯æ˜¯åœ¨bashé‡Œä½ è¿˜å¯ä»¥ <code>(echo 'hello   "   world')</code> ï¼Œå¯æ˜¯åœ¨adbä¸‹å°±ä¼šå‡ºé”™ï¼š
</p>

<pre class="example">
{ bhj@bhj-laptop /home/bhj/system-config/bin Ret: 130 @ 21:54:59 }
$(echo 'hello   "   world')
hello   "   world

{ bhj@bhj-laptop /home/bhj/system-config/bin }
$the-true-adb shell echo 'hello   "   world'
/system/bin/sh: no closing quote
</pre>

<p>
å¦‚æœä½ ç”¨straceå»çœ‹æ€ä¹ˆå›äº‹å„¿çš„è¯ï¼Œä½ ä¼šå‘ç°adbé€ç»™æ‰‹æœºæ‰§è¡Œçš„å‘½ä»¤æ˜¯è¿™æ ·çš„ï¼š
</p>

<pre class="example">
{ bhj@bhj-laptop /home/bhj/system-config/bin Ret: 130 @ 21:55:55 }
$strace -e write -f the-true-adb shell echo 'hello   "   world'
[ Process PID=7340 runs in 32 bit mode. ]
write(3, "000c", 4)                     = 4
write(3, "host:version", 12)            = 12
write(3, "0012", 4)                     = 4
write(3, "host:transport-any", 18)      = 18
write(3, "001e", 4)                     = 4
write(3, "shell:echo \"hello   \"   world\"", 30) = 30
write(1, "/system/bin/sh: no closing quote"..., 34/system/bin/sh: no closing quote
) = 34
</pre>

<p>
æŠŠå¼•å·å½’æ•´ä¸€ä¸‹ï¼Œæ‰‹æœºçš„shçœ‹åˆ°çš„å‘½ä»¤æ˜¯ <code>(echo "hello " world")</code> ï¼ˆå»æ‰æ‹¬
å·ï¼‰ã€‚
</p>

<p>
æŸ¥çœ‹ä¸€ä¸‹adbå¯¹å¼•å·çš„å¤„ç†ï¼š
</p>

<div class="org-src-container">

<pre class="src src-c">quote = (**argv == 0 || strchr(*argv, <span class="org-string">' '</span>));
<span class="org-keyword">if</span> (quote)
    strcat(buf, <span class="org-string">"\""</span>);
strcat(buf, *argv++);
<span class="org-keyword">if</span> (quote)
    strcat(buf, <span class="org-string">"\""</span>);
</pre>
</div>

<p>
èƒ½ä¸èƒ½æŠŠå¼•å·å¼„å¯¹æ˜¯bashè„šæœ¬ç¼–ç¨‹åŠŸåº•çš„ä¸€ç§ä½“ç°ğŸ˜Š å¦‚ä¹‹å‰æ‰€è¿°ï¼Œå¦‚æœæˆ‘æ˜¯åœ¨
ç”¨adb-expectæ‰“å¼€ä¸€ä¸ªç»ˆç«¯ç»™æ¯ä¸ªéäº¤äº’å¼çš„ <code>adb shell echo hello</code> è°ƒç”¨çš„
è¯ï¼Œé‚£å¼•å·ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼š
</p>

<pre class="example">
{ bhj@bhj-laptop /home/bhj/src/android/system/core/adb }
$adb-expect echo 'hello   "   world'
spawn the-true-adb shell
root@msm8974sfo:/ # exec 'echo' 'hello   "   world'
hello   "   world
</pre>

<p>
å¯æ˜¯è¿™æ ·å¤ªå½±å“æ€§èƒ½äº†ï¼Œå¹¶ä¸”ä¼šå½±å“æˆ‘å¯¹adbè¿›è¡Œç¼–ç¨‹ï¼Œæˆ‘å¿…é¡»æŠŠå‰é¢çš„ä¸¤è¡Œè¾“
å‡ºç»™è¿‡æ»¤æ‰ã€‚
</p>

<p>
æ‰€ä»¥æˆ‘è¿˜æ˜¯æŠŠå¼•å·æœºåˆ¶ç¡¬ç”Ÿç”Ÿç»™å®ƒæ°æ­£äº†ï¼š
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="org-variable-name">IFS</span>=$<span class="org-string">'\n'</span>
<span class="org-keyword">for</span> x<span class="org-keyword"> in</span> <span class="org-string">"$@"</span>; <span class="org-keyword">do</span>
    <span class="org-variable-name">args</span>=(<span class="org-string">"${args[@]}"</span> $(
                 <span class="org-keyword">if </span><span class="org-builtin">test</span> <span class="org-string">"$(</span><span class="org-sh-quoted-exec">printf</span><span class="org-string"> %q "$x")"</span> != <span class="org-string">"$x"</span>; <span class="org-keyword">then</span>
                     <span class="org-comment-delimiter"># </span><span class="org-comment">echo \"\'"$(</span><span class="org-sh-quoted-exec">echo</span><span class="org-comment"> -n "$x" | perl -npe "s!'!\\'!")"\'\"</span>
                     <span class="org-builtin">printf</span> <span class="org-string">\"</span>%q<span class="org-string">\"</span> <span class="org-string">"$x"</span>
                 <span class="org-keyword">else</span>
                     <span class="org-builtin">printf</span> %q <span class="org-string">"$x"</span>
                 <span class="org-keyword">fi</span>))
<span class="org-keyword">done</span>

<span class="org-keyword">exec</span> the-true-adb ${<span class="org-variable-name">args</span>[@]}
</pre>
</div>

<p>
å¦‚æœå‘ç°æŸä¸ªå‚æ•° (the x in "$@") éœ€è¦ quote çš„è¯( <code>(test "$(printf %q
"$x")" != "$x")</code> )ï¼Œé‚£æˆ‘ä»¬å°±ç»™å®ƒquoteï¼Œå¹¶å‰åå„åŠ ä¸€ä¸ªåŒå¼•å·ï¼š
ï¼ˆ <code>(printf \"%q\" "$x")</code> ï¼‰ã€‚å¦åˆ™å°±åªquoteä½†ä¸åŠ åŒå¼•å·ã€‚å› ä¸ºåœ¨åº•ä¸‹
<code>exec the-true-adb ${args[@]}</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ²¡æœ‰ç»™ <code>${args[@]}</code> åŠ ä¸ŠåŒ
å¼•å·ï¼Œæ‰€ä»¥ä¹‹å‰çš„quoteè¢«å–æ¶ˆï¼ˆprintf %qï¼‰ï¼Œä¼ è¿‡å»çš„å‚æ•°è·Ÿä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œ
ä½†ä¸åŒçš„æ˜¯æœ‰ä¸€äº›å‚æ•°å‰åå„åŠ äº†ä¸€ä¸ªåŒå¼•å·ï¼Œè¿™äº›å‚æ•°è¢«adbçš„.cç¨‹åºå†åœ¨å‰
åå„åŠ ä¸€åŒå¼•å·ï¼Œæœ€åç»“æœç­‰äºæ²¡åŠ ï¼Œå¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„bashå¼•å·è¡Œä¸ºï¼
</p>

<p>
æˆ‘çš„adbè„šæœ¬åœ¨ <a href="https://github.com/baohaojun/system-config/raw/master/bin/overide/adb">adb</a> ï¼Œæˆ‘è‡ªå·±å·²ç»å¿«çœ‹ä¸æ˜ç™½äº†ã€‚
</p>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><span class="section-number-4">1.3.2</span> PutClipService</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
åˆä¸€ä¸ªç¬¬ä¸‰çº§æ ‡é¢˜ï¼Œputclip-androidç”¨åˆ°çš„ä¸€ä¸ªæ‰‹æœºå°apkã€‚è¿™ä¸ªç¨‹åºè§ <a href="https://github.com/baohaojun/system-config/raw/master/gcode/SetClip/src/com/bhj/setclip/PutClipService.java">PutClipService.java</a> ã€‚
</p>

<div class="org-src-container">

<pre class="src src-java"><span class="org-keyword">package</span> com.bhj.<span class="org-constant">setclip</span>;

<span class="org-keyword">import</span> <span class="org-constant">android</span>.<span class="org-constant">app</span>.<span class="org-type">Service</span>;
<span class="org-keyword">import</span> <span class="org-constant">android</span>.<span class="org-constant">content</span>.<span class="org-type">ClipboardManager</span>;
<span class="org-keyword">import</span> <span class="org-constant">android</span>.<span class="org-constant">content</span>.<span class="org-type">ClipData</span>;
<span class="org-keyword">import</span> <span class="org-constant">android</span>.<span class="org-constant">content</span>.<span class="org-type">Intent</span>;
<span class="org-keyword">import</span> <span class="org-constant">android</span>.<span class="org-constant">os</span>.<span class="org-type">IBinder</span>;
<span class="org-keyword">import</span> <span class="org-constant">android</span>.<span class="org-constant">widget</span>.<span class="org-type">Toast</span>;
<span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">io</span>.<span class="org-type">File</span>;
<span class="org-keyword">import</span> <span class="org-constant">java</span>.<span class="org-constant">io</span>.<span class="org-type">FileReader</span>;

<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">PutClipService</span> <span class="org-keyword">extends</span> <span class="org-type">Service</span> {
    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">IBinder</span> <span class="org-function-name">onBind</span>(<span class="org-type">Intent</span> <span class="org-variable-name">intent</span>) {
        <span class="org-keyword">return</span> <span class="org-constant">null</span>;
    }

    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">int</span> <span class="org-function-name">onStartCommand</span>(<span class="org-type">Intent</span> <span class="org-variable-name">intent</span>,  <span class="org-type">int</span> <span class="org-variable-name">flags</span>,  <span class="org-type">int</span> <span class="org-variable-name">startId</span>)  {
        <span class="org-keyword">try</span> {
            <span class="org-type">FileReader</span> <span class="org-variable-name">f</span> = <span class="org-keyword">new</span> <span class="org-type">FileReader</span>(<span class="org-keyword">new</span> <span class="org-type">File</span>(<span class="org-string">"/sdcard/putclip.txt"</span>));
            <span class="org-type">char</span>[] <span class="org-variable-name">buffer</span> = <span class="org-keyword">new</span> <span class="org-type">char</span>[1024];
            <span class="org-type">int</span> <span class="org-variable-name">n</span> = f.read(buffer);
            <span class="org-type">String</span> <span class="org-variable-name">str</span> = <span class="org-keyword">new</span> <span class="org-type">String</span>(buffer, 0, n);
            <span class="org-type">ClipboardManager</span> <span class="org-variable-name">mClipboard</span>;
            mClipboard = (<span class="org-type">ClipboardManager</span>)getSystemService(CLIPBOARD_SERVICE);
            mClipboard.setPrimaryClip(ClipData.newPlainText(<span class="org-string">"Styled Text"</span>, str));
            <span class="org-type">File</span> <span class="org-variable-name">putclip</span> = <span class="org-keyword">new</span> <span class="org-type">File</span>(<span class="org-string">"/sdcard/putclip.txt"</span>);
            putclip.delete();
        } <span class="org-keyword">catch</span> (<span class="org-type">Exception</span> <span class="org-variable-name">e</span>) {
            Toast.makeText(<span class="org-keyword">this</span>, <span class="org-string">"Something went wrong in putclip: "</span> + e.getMessage(), <span class="org-constant">Toast</span>.LENGTH_SHORT).show();
        }
        <span class="org-keyword">return</span> START_STICKY;
    }

    <span class="org-c-annotation">@Override</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">onDestroy</span>() {
    }
}
</pre>
</div>

<p>
æœ€åputclip-androidé‡Œæ˜¯é€šè¿‡am startserviceæ¥å¯åŠ¨è¿™ä¸ªserviceçš„ã€‚è¿™ä¸ª
javaç¨‹åºä¼šæ‰“å¼€adb pushä¸Šæ¥çš„weixinå†…å®¹æ–‡ä»¶(/sdcard/putclip.txtï¼‰ï¼Œè¯»å‡º
æ¥ï¼Œæ”¾è¿›å‰ªè´´æ¿ï¼Œåˆ æ‰è¿™ä¸ªæ–‡ä»¶ã€‚è„šæœ¬é‡Œæœ‰ä¸€ä¸ªæ­»å¾ªç¯ä¸€ç›´åœ¨ç­‰å¾…è¿™ä¸ªæ–‡ä»¶è¢«åˆ 
é™¤æ‰è¿”å›ã€‚
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> adb-long-press å’Œ adb-tap</h2>
<div class="outline-text-2" id="text-2">
<p>
è¿™ä¸¤ä¸ªåŸºæœ¬ä¸Šå°±æ˜¯adbè‡ªå¸¦çš„inputå‘½ä»¤çš„å°è£…ã€‚å…¶ä¸­long-pressåœ¨adb inputå‘½
ä»¤é‡Œæ˜¯æ²¡æœ‰çš„ï¼Œä½†æ˜¯ç½‘ä¸ŠæŸ¥ä¸€ä¸‹ä¹Ÿèƒ½æŸ¥åˆ°ç”¨swipeæ¥å¯ä»¥æ¨¡æ‹Ÿå‡ºæ¥ï¼ˆè§
<a href="https://github.com/baohaojun/system-config/raw/master/bin/adb-long-press">adb-long-press</a>ï¼‰ï¼š
</p>

<div class="org-src-container">

<pre class="src src-sh"><span class="org-comment-delimiter">#</span><span class="org-comment">!/bin/</span><span class="org-keyword">bash</span>

<span class="org-variable-name">seconds</span>=550
<span class="org-keyword">if </span><span class="org-builtin">test</span> $<span class="org-variable-name">#</span> = 5 -o $<span class="org-variable-name">#</span> = 3; <span class="org-keyword">then</span>
    <span class="org-variable-name">seconds</span>=$<span class="org-variable-name">1</span>
    <span class="org-builtin">shift</span>
<span class="org-keyword">fi</span>
<span class="org-keyword">if </span><span class="org-builtin">test</span> $<span class="org-variable-name">#</span> = 4; <span class="org-keyword">then</span>
    adb shell input touchscreen swipe $<span class="org-variable-name">1</span> $<span class="org-variable-name">2</span> $<span class="org-variable-name">3</span> $<span class="org-variable-name">4</span> $<span class="org-variable-name">seconds</span>
<span class="org-keyword">elif </span><span class="org-builtin">test</span> $<span class="org-variable-name">#</span> = 2; <span class="org-keyword">then</span>
    adb shell input touchscreen swipe $<span class="org-variable-name">1</span> $<span class="org-variable-name">2</span> $<span class="org-variable-name">1</span> $<span class="org-variable-name">2</span> $<span class="org-variable-name">seconds</span>
<span class="org-keyword">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> sawfishå¿«æ·é”®</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">

<pre class="src src-sawfish"><span class="org-rainbow-delimiters-depth-1">(</span>bind-keys s-h-keymap <span class="org-string">"w"</span>  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>system <span class="org-string">"weixin&amp;"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>bind-keys global-keymap <span class="org-string">"XF86Mail"</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>synthesize-multiple-events <span class="org-string">"C-x"</span> <span class="org-string">"C-s"</span> <span class="org-string">"C-x"</span> <span class="org-string">"#"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
è¿™æ ·ï¼Œæˆ‘æŒ‰ä¸€ä¸‹ <code>s-h w</code> å°±èƒ½è°ƒå‡ºweixinçš„Emacsç¼–è¾‘ï¼Œè¾“å…¥å®Œå†…å®¹ä¹‹åï¼ŒæŒ‰ä¸€
ä¸‹æˆ‘çš„å¾®è½¯äººä½“å·¥å­¦4000é”®ç›˜ä¸Šçš„Mailé”®ï¼Œå°±ä¼šåƒæŒ‰é”®å°ç²¾çµä¸€æ ·ç»™Emacså‘4ä¸ª
é”®ï¼Œ <code>C-x C-s C-x #</code> ï¼Œæˆ‘çš„å¾®ä¿¡å°±å‘å‡ºå»äº†ã€‚
</p>

<p>
å½“ç„¶ï¼Œè¿™ä¹‹å‰ä½ éœ€è¦åšæ˜¯çš„ç¡®ä¿å·²ç»è°ƒå‡ºæ¥å¾®ä¿¡èŠå¤©çª—å£ã€‚
</p>

<p>
<del>å¦å¤–ï¼Œè¿™äº›è„šæœ¬éƒ½åªèƒ½åœ¨adb rootè¿‡åä½¿ç”¨å§å¥½åƒï¼Ÿä¸»è¦æ˜¯adb inputå‘½ä»¤å¿…é¡»æœ‰rootæƒé™ï¼Ÿè¿™ä¸ªä¸ç¡®å®šï¼Œä½†å³ä½¿æˆ‘ç”¨çš„æ˜¯userç‰ˆæœ¬çš„æ‰‹æœºï¼Œä¸èƒ½adb rootï¼Œæˆ‘çš„adbåŒ…è£…ä¹Ÿæœ‰ä¸€ä¸ªadb root-modeå‘½ä»¤ï¼Œè¿›å…¥ä¹‹åæ¯ä¸ªadb shell COMMANDéƒ½ä¼šè¢«é‡æ–°è§£é‡Šæˆ adb shell su -c 'quoted COMMAND'ï¼Œç›¸å½“åœ°ç»•å‘¢ï¼Œæˆ‘è‡ªå·±éƒ½å¿«è¢«ç»•æ™•äº†ã€‚</del>
</p>

<p>
æˆ‘è®°é”™äº†ï¼Œè¿™äº›è„šæœ¬æ˜¯ä¸éœ€è¦rootæƒé™çš„ã€‚Anyway, adb root-modeğŸ˜Š
</p>

<p>
æˆ‘çš„å¾®åšè´¦å·æ˜¯ baohaojunï¼Œæ¬¢è¿ç²‰æˆ‘ã€‚å¾®ä¿¡å·æ˜¯beagrepï¼Œæ¬¢è¿åŠ æˆ‘ã€‚æˆ‘èŠå¤©
æ‰“å­—é€Ÿåº¦å¾ˆå¿«çš„ã€‚
</p>
      <nav>
        <ul id="prev_next_posts">
          <li class="prev_post">
            <a href="../04/0-binder.html"> <!-- prev-url -->
              <i class="icon-chevron-left">ã€Š</i>
              binder <!-- prev-title -->
            </a>
          </li>
          <li class="next_post" style="text-align: right;">
            <a href="../../07/13/0-Smartisan-T1-Wrench.html"> <!-- next-url -->
              Smartisan T1 Wrench
Smartisan T1å°æ‰³æ‰‹ä½¿ç”¨æŒ‡å— <!-- next-title -->
              <i class="icon-chevron-right">ã€‹</i>
            </a>
          </li>
        </ul>
      </nav>
</div>
</div>
</div>
<!-- {%html-mode%} -->

<div id="disqus_container">
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: THIS CODE IS ONLY AN EXAMPLE * * */
    var disqus_shortname = 'baohaojun'; // Required - Replace example with your forum shortname
    var disqus_url = 'http://baohaojun.github.io/blog/2014/06/23/0-sending-weixin-weibo-etc-with-emacs-and-smartisa-t1.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
    <div style="margin-bottom:20px">
    <script type="text/javascript" charset="utf-8">
      (function(){
      var _w = 86 , _h = 16;
      var param = {
      url:location.href,
      type:'6',
      count:'', /**æ˜¯å¦æ˜¾ç¤ºåˆ†äº«æ•°ï¼Œ1æ˜¾ç¤º(å¯é€‰)*/
      appkey:'', /**æ‚¨ç”³è¯·çš„åº”ç”¨appkey,æ˜¾ç¤ºåˆ†äº«æ¥æº(å¯é€‰)*/
      title:'', /**åˆ†äº«çš„æ–‡å­—å†…å®¹(å¯é€‰ï¼Œé»˜è®¤ä¸ºæ‰€åœ¨é¡µé¢çš„title)*/
      pic:'', /**åˆ†äº«å›¾ç‰‡çš„è·¯å¾„(å¯é€‰)*/
      ralateUid:'1611427581', /**å…³è”ç”¨æˆ·çš„UIDï¼Œåˆ†äº«å¾®åšä¼š@è¯¥ç”¨æˆ·(å¯é€‰)*/
      language:'zh_cn', /**è®¾ç½®è¯­è¨€ï¼Œzh_cn|zh_tw(å¯é€‰)*/
      rnd:new Date().valueOf()
      }
      var temp = [];
      for( var p in param ){
      temp.push(p + '=' + encodeURIComponent( param[p] || '' ) )
      }

      })()
    </script>
  </div>
  <div id="disqus_thread"></div>
</div>

</div> <!-- bhj_leftpane -->
<div id="sidebar"><div id="sidebar2">


  <!-- Begin #profile-container -->

   <div id="profile-container"><h2 class="sidebar-title">About Me</h2>
<dl class="profile-datablock"><dt class="profile-img"><a href="/images/bhj.png""><img src="/images/bhj-thumb.png" alt="My Photo" height="58" width="80"></a></dt>
<dd class="profile-data"><strong>Name:</strong> <a rel="author" href="https://www.github.com/baohaojun"> Bao Haojun </a></dd>
<dd class="profile-data"><strong>Location:</strong>  Beijing, China </dd></dl>

<p class="profile-link"><a rel="author" href="/blog/2011/12/23/index.html">View my complete profile</a></p></div>

  <!-- End #profile -->



  <h2 class="sidebar-title">Feeds</h2>
    <ul>
        <li><a href="/atom.xml">Atom</a></li>
    </ul>

  <h2 class="sidebar-title">Projects</h2>
    <dl>
        <dt><a href="/blog/2011/12/23/beagrep.html"> Beagrep </a></dt>
        <dd> Grep 2G source code in 0.23 second </dd>

        <dt><a href="/blog/2013/04/13/skeleton-complete.html"> Skeletom-complete.el </a></dt>
        <dd> Type a bare skeleton, complete to a symbol/partial line/sexp/paragraph </dd>

        <dt><a href="/blog/2011/12/28/org-jira.html"> Org-jira.el </a></dt>
        <dd> Use JIRA with org-mode </dd>
    </dl>

    <h2>Tags</h2>
    <ul>
                <li><a href="../../../../meta/tags/tool.html" title="Computer tools">tool</a></li>
    </ul>

  <h2 class="sidebar-title">Previous Posts</h2>
    <ul id="recently">
        <li><a href='../04/0-binder.html'> binder </a></li>
<li><a href='../../05/20/0-build-tar-for-android-under-x86-64-debian.html'> åœ¨Debianä¸‹ä¸ºå®‰å“åšä¸€ä¸ªGNU tarç¨‹åº </a></li>
<li><a href='../../01/28/0-Firefor-urlbar-dropdown-list-not-showing-anymore.html'> Firefor urlbar dropdown list not showing anymore </a></li>
<li><a href='../../01/16/0-Use-GreaseMonkey-to-disable-google-redirect.html'> ç”¨GreaseMonkeyç¦æ­¢Googleæœç´¢é‡å®šå‘ç»‘æ¶ </a></li>
<li><a href='../../01/03/0-7-habits-of-highly-effective-editting.html'> é«˜æ•ˆæ–‡æœ¬ç¼–è¾‘çš„ä¸ƒä¸ªä¹ æƒ¯ </a></li>
<li><a href='../../../2013/12/11/0-ssh-remote-command-and-bash--c-string.html'> sshæ‰§è¡Œè¿œç¨‹å‘½ä»¤å’Œbash -c stringçš„ç”¨æ³• </a></li>
<li><a href='../../../2013/11/07/0-programming-discovery.html'> å‘ç°å¼ç¼–ç¨‹ </a></li>
<li><a href='../../../2013/10/16/0-Interactive-Git-Add.html'> Interactive Git Add </a></li>
<li><a href='../../../2013/10/05/0-My-Own-Win32-Input-Method.html'> è‡ªå·±å†™äº†ä¸€ä¸ªè¾“å…¥æ³•, Windowsä¸‹çš„äº”ç¬” </a></li>
<li><a href='../../../2013/10/04/0-Win32-IME-Programming.html'> æˆ‘çš„Win32è¾“å…¥æ³•ç¼–ç¨‹å¿ƒå¾— </a></li>
    </ul>

    <h2 class="sidebar-title">Archive</h2>
      <ul id="archives">
        <li><a href="/meta/Archive.html"> The complete archive </a></li>
      </ul>

  <!--
  <p>This is a paragraph of text that could go in the sidebar.</p>
  -->



</div></div>
<!-- End #sidebar -->
</div> <!-- End #bhj_article -->
<!-- {%/html-mode%} -->
<div id="postamble" class="status">
<!-- {%html-mode%} -->

<!-- {%/html-mode%} -->
</div>
</body>
</html>
